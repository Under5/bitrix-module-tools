#### [Главная страница](../README.md)

## ORM сервис работы с предметной областью

Наиболее удобным вариант представления сущьностей проекта является их в виде объектов. В текщий момент CMS Битрикс не имеет 
встроенную ORM для работы с ее сущьностями. Не имея такого инструмента разработчикам приходится работать с данными в 
виде ассоциативных массивов что при водит к частому дублированию логики и частым ошибкам. Сервис ORM призван решить проблему 
недостачи подходящего инстумента для работы с данными в виде объектов.

### Особенности

* Определение единой логики поведения объектов предметной области определенной сущьности
* Быстрый и удобный доступ к данным во время разработки
* Одна сущьность предметной области представлена один экземпляром объекта в приложении, что позволяет избежать рассогласованности данных
* Работа с взаимосвязанными сущьностями

### Использование

Следующий пример демонстрирует получение новостей со связими с их авторами, далее идет вывод имен авторов
```php
<?php
CModule::IncludeModule('ws.tools');
$module = \WS\Tools\Module::getInstance();

$orm = $module->orm();

$collection = $orm->createSelectRequest(\Domain\Entity\ShopNews::className())
    ->withRelations(array('author'))
    ->getCollection();

/** @var \Domain\Entity\ShopNews $item */
foreach ($collection as $item) {
    var_dump($item->author->name);
}

```

Т.о выполнено минимум действий. Для получения списка элементов в стандартном api действий потребуется гораздо больше.

### Определение моделей предметной области

Модели предметной области определяются на основе информационных блоков. В административном интерфейсе проекта создается инфоблок, 
а в коде проекта вы воздаете его описание , в виде класса, согласно некоторым правилам.

```php
<?php

namespace Domain\Entity;

/**
 * @property integer $id
 * @property string $name
 * @property string $description DESCRIPTION
 * @property \WS\Tools\ORM\BitrixEntity\User $author
 *
 * @gateway iblockElement
 * @iblockCode shop_news
 */
class ShopNews extends \WS\Tools\ORM\Entity {
}
```

Выше представлена полноценная модель предметной области. Поля модели и ее ассоциация с информационным блоком описываются в 
doc блоке класса. Поля обозначаются через обозначение ```@property``` в блоке.

* ```@property``` описание свойства модели, далее в строке указываются: тип, имя свойства, имя свойства информационного блока. Если имя свойства инфоблока и модели совпадают 3 параметр можно пропустить
* ```@gateway``` определение шлюза работы с данными для ORM. В основном это всегда будет ```iblockElement```
* ```@iblockCode``` код информационного блока из настроек административного интерфейса, так же вместо этого параметра можно использовать ```@iblockId```

### Определение связей

### Получение объектов

### Создание, созранение, удаление

### Дополнение

#### Получение вариантов знаячений списка конкретного инфоблока

#### Работа с proxy оъектами

#### Специальные сущьности

#### Работа с фильтром по условию "OR"
